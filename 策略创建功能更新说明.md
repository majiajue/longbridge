# 策略创建功能更新说明

## 更新概述

本次更新为**策略控制中心**添加了完整的策略管理功能，用户现在可以直接在界面上创建、编辑和删除交易策略，无需手动编辑配置文件。

## 主要功能

### ✅ 1. 创建新策略
- **入口**: 策略控制页面右上角的"新建策略"按钮
- **支持策略类型**:
  - 均线交叉策略 (ma_crossover)
  - RSI 超卖反弹策略 (rsi_oversold)
  - 突破策略 (breakout)
  - 布林带策略 (bollinger_bands)
  - MACD 背离策略 (macd)
- **配置项**:
  - 策略名称（必填）
  - 策略描述（可选）
  - 策略类型（下拉选择）
  - 监控标的（支持多个，用逗号分隔）

### ✅ 2. 编辑策略
- **入口**: 策略卡片右下角的设置图标 ⚙️
- **可编辑项**: 监控标的列表

### ✅ 3. 删除策略
- **入口**: 策略卡片左下角的删除图标 🗑️
- **限制**: 只能删除已禁用的策略
- **安全机制**: 需要确认才能删除

## 技术实现

### 后端 API

#### 创建策略
```
POST /strategies/
```
**参数**:
- `name`: 策略名称
- `description`: 策略描述
- `symbols`: 监控标的数组
- `strategy_type`: 策略类型

**返回**:
```json
{
  "message": "Strategy 'xxx' created successfully",
  "strategy_id": "ma_crossover_abc123",
  "strategy": { ... }
}
```

#### 删除策略
```
DELETE /strategies/{strategy_id}
```
**限制**: 策略必须处于禁用状态

**返回**:
```json
{
  "message": "Strategy xxx deleted successfully"
}
```

### 前端更新

#### 新增组件
- 创建策略对话框 (CreateDialog)
- 策略类型选择器 (FormControl + Select)
- 删除确认功能

#### 新增状态管理
```typescript
const [createDialog, setCreateDialog] = useState(false);
const [newStrategy, setNewStrategy] = useState({
  name: '',
  description: '',
  symbols: '',
  strategy_type: 'ma_crossover',
});
```

#### UI 改进
- 添加"新建策略"按钮
- 每个策略卡片添加删除按钮
- 删除按钮在策略启用时自动禁用
- 添加工具提示说明

## 使用示例

### 示例 1: 创建腾讯均线策略

1. 点击"新建策略"
2. 填写信息:
   - 名称: `腾讯均线策略`
   - 描述: `监控腾讯股价，使用5日和20日均线交叉`
   - 类型: `均线交叉策略`
   - 标的: `700.HK`
3. 点击"创建"
4. 在列表中找到新策略，打开开关启用

### 示例 2: 创建多标的 RSI 策略

1. 点击"新建策略"
2. 填写信息:
   - 名称: `港股超卖反弹`
   - 描述: `监控多只港股的超卖反弹机会`
   - 类型: `RSI 超卖反弹策略`
   - 标的: `700.HK, 9988.HK, 0005.HK`
3. 点击"创建"
4. 启用策略

### 示例 3: 删除不需要的策略

1. 找到要删除的策略
2. 如果策略已启用，先关闭开关
3. 点击左下角的删除图标 🗑️
4. 在确认对话框中点击"确定"
5. 策略被删除

## 代码变更

### 后端文件
- **backend/app/routers/strategies.py**
  - 添加 `create_strategy()` 接口
  - 添加 `delete_strategy()` 接口
  - 包含 5 种策略模板配置

### 前端文件
- **frontend/src/pages/StrategyControl.tsx**
  - 添加创建策略功能
  - 添加删除策略功能
  - 优化 UI 布局
  - 添加新的 Material-UI 组件导入

### 配置文件
- **config/strategies.json**
  - 动态更新（通过 API 自动保存）

## 预定义策略模板

每种策略类型都有优化的默认参数：

| 策略类型 | 止损 | 止盈 | 仓位大小 | 最大持仓 |
|---------|------|------|---------|---------|
| 均线交叉 | 5% | 15% | 10% | 3 |
| RSI 超卖 | 3% | 8% | 15% | 2 |
| 突破策略 | 4% | 12% | 20% | 2 |
| 布林带 | 2.5% | 6% | 25% | 2 |
| MACD | 4% | 10% | 15% | 3 |

## 安全机制

### 创建策略
- ✅ 自动生成唯一的策略 ID
- ✅ 新策略默认禁用状态
- ✅ 自动保存到配置文件
- ✅ 包含完整的风险管理参数

### 删除策略
- ✅ 禁止删除已启用的策略
- ✅ 需要用户确认
- ✅ 同时清理相关状态数据
- ✅ 自动保存更新后的配置

### 编辑策略
- ✅ 实时验证输入
- ✅ 自动保存更改
- ✅ 保持策略运行状态

## 全局限制

系统内置的风险控制限制：

```json
{
  "max_daily_trades": 10,        // 每日最多 10 笔交易
  "max_total_positions": 5,      // 全局最多 5 个持仓
  "max_risk_per_trade": 0.02,    // 单笔交易最大风险 2%
  "cooldown_period": 300          // 冷却期 5 分钟
}
```

## 智能信号分析

所有新创建的策略默认启用智能信号分析 (`use_optimal_signals: true`)：

- 📊 多因子综合评估
- 🎯 动态止损止盈优化
- 📈 市场情绪分析
- 🔍 高置信度信号过滤
- ⚡ 实时风险评估

## 下一步计划

可能的未来改进：

- [ ] 支持编辑策略的完整参数（止损、止盈等）
- [ ] 策略模板市场
- [ ] 策略回测功能
- [ ] 策略克隆功能
- [ ] 批量操作（批量启用/禁用）
- [ ] 策略分组管理
- [ ] 导入/导出策略配置
- [ ] 策略性能统计和分析

## 文档链接

- **详细使用指南**: [docs/STRATEGY_CREATION_GUIDE.md](docs/STRATEGY_CREATION_GUIDE.md)
- **策略引擎文档**: [docs/STRATEGIES_GUIDE.md](docs/STRATEGIES_GUIDE.md)
- **架构说明**: [docs/ARCHITECTURE.md](docs/ARCHITECTURE.md)

## 快速开始

### 1. 启动系统
```bash
./start.sh
```

### 2. 访问策略控制
打开浏览器访问: http://localhost:8000

点击顶部的"策略控制"标签

### 3. 创建第一个策略
1. 点击"新建策略"
2. 输入策略名称（例如："我的第一个策略"）
3. 选择策略类型（例如："均线交叉策略"）
4. 输入监控标的（例如："AAPL.US"）
5. 点击"创建"
6. 启用策略开始监控

## 测试验证

### 验证创建功能
```bash
# 查看策略数量（应该增加）
cat config/strategies.json | grep -c '"id"'
```

### 验证 API
```bash
# 创建测试策略
curl -X POST http://localhost:8000/strategies/ \
  -H "Content-Type: application/json" \
  -d '{
    "name": "测试策略",
    "description": "API测试",
    "symbols": ["AAPL.US"],
    "strategy_type": "ma_crossover"
  }'

# 查看所有策略
curl http://localhost:8000/strategies/

# 删除策略（需要先禁用）
curl -X DELETE http://localhost:8000/strategies/ma_crossover_xxxxx
```

## 问题反馈

如遇到问题，请检查：

1. **浏览器控制台** - 查看前端错误
2. **后端日志** - `logs/backend.log`
3. **策略配置** - `config/strategies.json`
4. **API 状态** - http://localhost:8000/docs

## 总结

本次更新大大简化了策略管理流程，用户无需直接编辑 JSON 配置文件，可以完全通过界面完成策略的创建、配置和管理。这使得系统更加用户友好，降低了使用门槛。

**核心改进**:
- ✅ 界面化策略创建
- ✅ 5 种预定义策略模板
- ✅ 完整的策略生命周期管理
- ✅ 安全的删除机制
- ✅ 实时状态更新

享受更简单的量化交易体验！🚀

















