# AI 自动交易系统使用指南

## 📋 系统概述

AI 自动交易系统是一个基于 DeepSeek AI 的全自动量化交易解决方案，能够：

- 🤖 使用 DeepSeek 分析 K 线数据并生成交易决策
- 📊 自动计算技术指标（MA、RSI、MACD、布林带等）
- 💰 智能仓位管理和风险控制
- 🔄 全自动执行买卖交易（当前为模拟模式）
- 📈 完整的交易记录和绩效统计

---

## 🚀 快速开始

### 1. 获取 DeepSeek API Key

访问 [DeepSeek 官网](https://platform.deepseek.com/) 注册并获取 API Key。

### 2. 配置系统

1. 启动系统：`./start.sh`
2. 访问前端：http://localhost:5173
3. 点击「AI 交易」标签页
4. 点击右上角设置图标⚙️
5. 填写配置：
   - ✅ 启用 AI 自动交易
   - 🔑 输入 DeepSeek API Key
   - 📊 添加监控股票池（例如：`700.HK, AAPL.US, 9988.HK`）
   - ⚙️ 调整其他参数（可选）

### 3. 启动引擎

1. 点击右上角「启动」按钮
2. 系统将开始自动监控和交易
3. 实时查看 AI 分析记录和交易执行

---

## 🎛️ 配置参数说明

| 参数 | 说明 | 默认值 | 建议 |
|------|------|--------|------|
| **启用 AI 自动交易** | 总开关 | false | 测试后再启用 |
| **DeepSeek API Key** | AI 服务密钥 | - | 必填 |
| **监控股票池** | 要监控的股票代码 | [] | 2-10 只股票 |
| **检查间隔** | 多久分析一次（分钟） | 5 | 5-30 分钟 |
| **最小信心度** | 交易执行的最低信心度 | 0.75 | 0.75-0.85 |
| **每日最大交易次数** | 每天最多交易次数 | 20 | 10-30 次 |
| **每日最大亏损** | 达到此亏损就停止交易 | $5000 | 根据资金调整 |
| **每笔固定交易金额** | 每次交易的金额 | $10000 | 根据资金调整 |

---

## 📊 AI 分析流程

```
1. 获取 K 线数据 (最近 100 根)
     ↓
2. 计算技术指标
   - MA5/MA20/MA60 (移动平均线)
   - RSI (相对强弱指标)
   - MACD (指数平滑异同移动平均线)
   - 布林带 (Bollinger Bands)
   - 成交量分析
     ↓
3. 发送给 DeepSeek AI
   - 专业的系统提示词
   - 结构化的数据格式
   - 强制 JSON 输出
     ↓
4. AI 返回决策
   {
     "action": "BUY/SELL/HOLD",
     "confidence": 0.85,
     "reasoning": ["理由1", "理由2", ...],
     "stop_loss": 315.0,
     "take_profit": 330.0
   }
     ↓
5. 风控检查
   - 信心度是否达标？
   - 是否达到每日限额？
   - 是否有足够资金？
   - 是否设置止损？
     ↓
6. 执行交易（模拟/真实）
     ↓
7. 记录到数据库
```

---

## 🛡️ 风险控制机制

系统内置多层风险控制：

### 1. **信心度检查**
- 只有当 AI 的信心度 ≥ 设定阈值时才执行交易
- 建议设置 0.75 或更高

### 2. **每日交易次数限制**
- 防止过度交易
- 避免追涨杀跌

### 3. **每日亏损限制**
- 达到设定的最大亏损后自动停止
- 保护本金

### 4. **仓位控制**
- 每笔交易固定金额
- 单只股票最大仓位限制

### 5. **强制止损**
- AI 必须为每笔交易设置止损价
- 自动平仓保护

### 6. **持仓管理**
- 同一股票不能重复买入
- 必须有持仓才能卖出

---

## 📱 前端界面说明

### 🔍 AI 分析记录

查看最近的 AI 分析决策：

- 📊 股票代码
- 🎯 操作建议（BUY/SELL/HOLD）
- 💯 信心度百分比
- ✓/⏭ 是否执行/跳过
- 📝 详细理由（点击展开）

### 📝 交易记录

查看历史交易：

- ⏰ 交易时间
- 🏷️ 股票代码
- 🔄 买入/卖出
- 💰 数量和价格
- 📈 盈亏（仅卖出）
- 🎯 AI 信心度

### 💼 持仓管理

查看当前持仓：

- 📊 持仓数量
- 💵 成本价/当前价
- 📈 未实现盈亏
- ⏰ 开仓时间

---

## 🔧 技术架构

### 后端（Python/FastAPI）

```
backend/app/
├── ai_analyzer.py          # DeepSeek AI 分析器
├── ai_trading_engine.py    # 交易引擎核心
├── routers/ai_trading.py   # API 路由
├── repositories.py         # 数据库操作
└── db.py                   # 数据库表定义
```

### 前端（React/TypeScript）

```
frontend/src/pages/
└── AiTrading.tsx           # AI 交易主页面
```

### 数据库表（DuckDB）

- `ai_trading_config` - 配置表
- `ai_analysis_log` - AI 分析记录
- `ai_trades` - 交易记录
- `ai_positions` - 持仓表
- `ai_daily_summary` - 每日统计

---

## ⚙️ API 接口

### 引擎控制

```bash
# 启动引擎
POST /ai-trading/engine/start

# 停止引擎
POST /ai-trading/engine/stop

# 获取状态
GET /ai-trading/engine/status
```

### 配置管理

```bash
# 获取配置
GET /ai-trading/config

# 更新配置
PUT /ai-trading/config
```

### 数据查询

```bash
# AI 分析记录
GET /ai-trading/analysis?limit=50&symbol=700.HK

# 交易记录
GET /ai-trading/trades?limit=50&status=FILLED

# 持仓查询
GET /ai-trading/positions

# 统计数据
GET /ai-trading/statistics/daily?days=7
GET /ai-trading/statistics/performance?days=30
```

---

## 🎯 AI 决策标准

### 买入条件（至少满足 3 条）

✓ **趋势**：价格在 MA20 上方且向上  
✓ **动量**：MACD 金叉或 RSI 从超卖区反弹  
✓ **量能**：成交量明显放大（1.5倍以上）  
✓ **形态**：突破关键阻力位或布林带下轨反弹  

### 卖出条件（满足任一条）

✗ **止损触发**：价格跌破止损位  
✗ **止盈触发**：达到目标收益  
✗ **趋势反转**：MACD 死叉 + 跌破 MA20  
✗ **量能衰竭**：价格滞涨 + 成交量萎缩  
✗ **RSI 超买**：RSI > 70 且出现顶背离  

### 信心度标准

- **0.9-1.0**: 多个强烈信号共振，历史胜率高
- **0.75-0.9**: 明确信号，符合策略条件
- **0.6-0.75**: 信号存在但不够强烈，建议观望
- **<0.6**: 信号矛盾或不明确，必须 HOLD

---

## ⚠️ 注意事项

### 当前为模拟交易模式

系统当前**不会执行真实交易**，所有订单都是模拟的。如需真实交易：

1. 在 `ai_trading_engine.py` 中集成 Longbridge `trading_api`
2. 替换模拟下单逻辑为真实 API 调用
3. 充分测试后再启用

### 安全建议

1. ✅ 先在模拟模式下运行数天，观察 AI 决策质量
2. ✅ 设置合理的每日交易限额和亏损上限
3. ✅ 定期检查 AI 分析记录和交易结果
4. ✅ 不要过度依赖 AI，保留人工审核
5. ✅ 市场极端情况下及时停止引擎

### 成本考虑

- DeepSeek API 调用费用（按 token 计费）
- 建议每次分析间隔 5-30 分钟，避免过于频繁
- 监控股票数量建议 2-10 只

---

## 📊 性能监控

系统提供完整的统计分析：

- 📈 总收益率
- 🏆 胜率
- 💰 盈亏比
- 📊 每日盈亏曲线
- 🎯 AI 平均信心度
- 📉 最大回撤

---

## 🐛 故障排查

### 引擎启动失败

1. 检查 DeepSeek API Key 是否正确
2. 检查网络连接
3. 查看后端日志：`logs/backend.log`

### AI 分析失败

1. 确认 K 线数据已同步
2. 检查股票代码格式（例如：700.HK，AAPL.US）
3. 查看 AI 分析日志中的错误信息

### 交易未执行

1. 检查信心度是否达标
2. 查看「跳过原因」
3. 确认未达到每日限额

---

## 📚 进阶功能（TODO）

未来可以扩展的功能：

- ✨ 支持更多 AI 模型（GPT-4、Claude 等）
- 📸 K 线图截图分析（视觉模型）
- 🔔 实时推送通知（Telegram/邮件）
- 📊 回测功能
- 🎯 多策略组合
- 📈 机器学习优化参数

---

## 🤝 技术支持

如有问题，请查看：

- 后端日志：`logs/backend.log`
- 前端控制台
- API 文档：http://localhost:8000/docs

---

**⚠️ 免责声明**

本系统仅供学习和研究使用。量化交易存在风险，过往表现不代表未来收益。请谨慎使用，风险自负。

















