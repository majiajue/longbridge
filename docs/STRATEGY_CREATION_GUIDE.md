# 策略创建和管理指南

本指南介绍如何在策略控制页面创建、编辑和删除交易策略。

## 功能概览

策略控制中心现在支持：
- ✅ **创建新策略** - 通过界面创建自定义策略
- ✅ **编辑策略** - 修改现有策略的监控标的
- ✅ **删除策略** - 删除不需要的策略（仅限已禁用的策略）
- ✅ **启用/禁用策略** - 实时控制策略运行状态
- ✅ **实时监控** - WebSocket 实时更新策略状态

## 创建新策略

### 步骤 1: 打开创建对话框

1. 访问 **策略控制** 页面
2. 点击右上角的 **"新建策略"** 按钮
3. 填写策略信息

### 步骤 2: 填写策略信息

**必填字段：**
- **策略名称**: 给策略起一个有意义的名称（例如："我的腾讯均线策略"）

**可选字段：**
- **策略描述**: 描述策略的作用和特点
- **策略类型**: 选择预定义的策略类型
- **监控标的**: 输入要监控的股票代码（用逗号分隔）

### 步骤 3: 选择策略类型

系统提供 5 种预定义策略类型：

#### 1. 均线交叉策略 (ma_crossover)
- **适用场景**: 趋势跟踪
- **原理**: 短期均线上穿长期均线时买入，下穿时卖出
- **参数**: 
  - 短期均线: 5 日
  - 长期均线: 20 日
  - 止损: 5%
  - 止盈: 15%

#### 2. RSI 超卖反弹策略 (rsi_oversold)
- **适用场景**: 超卖反弹
- **原理**: RSI < 30 时买入，RSI > 70 时卖出
- **参数**:
  - RSI 周期: 14
  - 超卖阈值: 30
  - 超买阈值: 70
  - 止损: 3%
  - 止盈: 8%

#### 3. 突破策略 (breakout)
- **适用场景**: 强势突破
- **原理**: 价格突破 20 日高点时买入
- **参数**:
  - 观察周期: 20 日
  - 确认K线: 2 根
  - 止损: 4%
  - 止盈: 12%

#### 4. 布林带策略 (bollinger_bands)
- **适用场景**: 均值回归
- **原理**: 触及下轨时买入，触及上轨时卖出
- **参数**:
  - 周期: 20
  - 标准差: 2
  - 止损: 2.5%
  - 止盈: 6%

#### 5. MACD 背离策略 (macd)
- **适用场景**: 趋势反转
- **原理**: MACD 线上穿信号线时买入
- **参数**:
  - 快线: 12
  - 慢线: 26
  - 信号线: 9
  - 止损: 4%
  - 止盈: 10%

### 步骤 4: 设置监控标的

在 **监控标的** 字段输入股票代码，多个代码用逗号分隔：

**示例：**
```
700.HK, AAPL.US, TSLA.US
```

**支持的市场：**
- 香港股票：代码.HK （例如：700.HK, 0005.HK）
- 美国股票：代码.US （例如：AAPL.US, TSLA.US）

### 步骤 5: 创建并启用

1. 点击 **"创建"** 按钮
2. 新策略将显示在策略列表中（默认为禁用状态）
3. 检查策略配置
4. 使用开关启用策略开始监控

## 编辑策略

### 修改监控标的

1. 找到要编辑的策略卡片
2. 点击右下角的 **设置图标** (⚙️)
3. 在对话框中修改监控标的
4. 点击 **"保存"** 应用更改

**注意：** 当前版本仅支持修改监控标的。要修改策略类型或其他参数，需要删除并重新创建策略。

## 删除策略

### 前提条件
- 策略必须处于 **禁用** 状态
- 如果策略已启用，需要先关闭开关禁用策略

### 删除步骤
1. 确保策略已禁用（开关为关闭状态）
2. 点击策略卡片左下角的 **删除图标** (🗑️)
3. 在确认对话框中点击 **"确定"**
4. 策略将从列表中移除并从配置文件中删除

## 启用/禁用策略

### 启用策略
1. 找到要启用的策略
2. 打开右上角的 **开关**
3. 策略状态将变为 **"监控中"**
4. 系统开始监控该策略的标的

### 禁用策略
1. 找到要禁用的策略
2. 关闭右上角的 **开关**
3. 策略状态将变为 **"空闲"**
4. 系统停止该策略的监控

## 策略状态说明

| 状态 | 描述 | 颜色 |
|------|------|------|
| 空闲 | 策略已禁用，未运行 | 灰色 |
| 监控中 | 策略正在监控市场数据 | 蓝色 |
| 已触发 | 策略条件满足，准备交易 | 橙色 |
| 执行中 | 正在执行交易 | 绿色 |
| 冷却中 | 交易后冷却期 | 青色 |

## 最佳实践

### 1. 测试新策略
- 新创建的策略默认禁用
- 建议先检查配置再启用
- 可以先用小仓位测试

### 2. 合理设置监控标的
- 不要在单个策略中添加过多标的（建议 2-5 个）
- 选择流动性好的标的
- 避免同时监控相关性强的标的

### 3. 风险管理
- 系统限制：
  - 单个策略最多 3 个持仓
  - 全局最多 5 个持仓
  - 每日最多 10 笔交易
- 每个策略都有预设的止损止盈
- 建议监控持仓并及时调整

### 4. 策略组合
- 可以同时启用多个不同类型的策略
- 不同策略类型适合不同市场环境
- 建议组合使用趋势跟踪和反转策略

### 5. 定期维护
- 定期检查策略表现
- 删除表现不佳的策略
- 根据市场变化调整监控标的

## API 接口说明

如果需要通过 API 操作策略，可以使用以下接口：

### 创建策略
```bash
POST /strategies/
Content-Type: application/json

{
  "name": "我的策略",
  "description": "策略描述",
  "symbols": ["700.HK", "AAPL.US"],
  "strategy_type": "ma_crossover"
}
```

### 删除策略
```bash
DELETE /strategies/{strategy_id}
```

### 更新策略
```bash
PUT /strategies/{strategy_id}
Content-Type: application/json

{
  "symbols": ["TSLA.US", "NVDA.US"]
}
```

### 启用/禁用策略
```bash
POST /strategies/{strategy_id}/enable
POST /strategies/{strategy_id}/disable
```

## 故障排查

### 问题：无法创建策略
- **检查**: 策略名称是否填写
- **解决**: 确保填写了必填字段

### 问题：无法删除策略
- **检查**: 策略是否已禁用
- **解决**: 先关闭策略开关，再删除

### 问题：策略不执行交易
- **检查**: 
  1. 策略是否已启用
  2. 监控标的是否正确
  3. 是否达到每日交易限制
  4. 是否在冷却期
- **解决**: 检查策略状态和日志

### 问题：找不到新建策略按钮
- **检查**: 是否在"策略控制"页面
- **解决**: 点击顶部导航的"策略控制"标签

## 高级功能

### 智能信号分析
所有新创建的策略默认启用 `use_optimal_signals: true`，这意味着：
- 使用 AI 增强的信号分析
- 多因子综合评估
- 动态止损止盈优化
- 更高的交易置信度要求

### 实时推送
- 策略状态通过 WebSocket 实时更新
- 无需手动刷新页面
- 连接状态显示在右上角

### 持仓监控
- 在"当前持仓"表格中查看所有策略的持仓
- 实时显示盈亏
- 包含止损止盈价格

## 相关文档

- [策略引擎指南](./STRATEGIES_GUIDE.md)
- [风险管理说明](./ERROR_HANDLING.md)
- [架构文档](./ARCHITECTURE.md)

## 更新日志

### v1.0.0 (2025-01-22)
- ✅ 添加策略创建功能
- ✅ 添加策略删除功能
- ✅ 支持 5 种预定义策略类型
- ✅ 优化用户界面体验
- ✅ 增加错误处理和验证

















