# 智能仓位管理系统 - 启动指南

## ✅ 已修复问题

刚才的启动失败是因为缺少 `save_monitoring_event` 函数，现已修复！

## 🚀 快速启动

### 1. 启动系统

```bash
./start.sh
```

系统会自动：
- ✅ 启动后端服务（端口 8000）
- ✅ 启动前端服务（端口 5173）
- ✅ 等待服务就绪

### 2. 访问系统

打开浏览器访问：**http://localhost:8000**

### 3. 使用智能仓位功能

点击顶部的 **"智能仓位"** 标签 🎲

## 📋 完整功能列表

### 已实现功能

1. **策略创建和删除** ✅
   - 创建新策略（5种类型）
   - 删除不需要的策略
   - 编辑策略配置
   
2. **智能仓位管理** ✅ (新增)
   - 单个仓位计算
   - 批量策略生成
   - 资金管理
   - 风险评估

3. **其他功能**
   - 持仓K线
   - 策略盯盘
   - 持仓监控
   - 实时行情
   - 信号分析

## 🎯 智能仓位使用步骤

### 单个股票计算

```
1. 输入股票代码：700.HK
2. 选择操作：买入
3. 选择方法：资金百分比
4. 设置比例：10%
5. 点击"计算"

→ 系统显示：
- 建议买入数量
- 预估成本
- 风险等级
- 止损止盈建议
```

### 批量生成策略

```
1. 点击"新建批量任务"
2. 输入股票列表：AAPL.US, TSLA.US, NVDA.US
3. 选择策略类型：均线交叉
4. 设置配置比例：10%
5. 点击"生成"

→ 系统自动：
- 计算每只股票的数量
- 创建交易策略
- 显示批量结果
```

## 🔧 故障排查

### 问题1：后端启动失败

**检查日志：**
```bash
tail -50 logs/backend.log
```

**常见原因：**
- Python 依赖未安装
- 端口 8000 被占用
- 配置文件错误

**解决方法：**
```bash
cd backend
pip install -r requirements.txt
```

### 问题2：前端无法访问

**检查前端服务：**
```bash
# 前端应该自动启动在 5173 端口
# 但通过 nginx 反向代理到 8000 端口
curl http://localhost:8000
```

### 问题3：数据库错误

**重置数据库：**
```bash
rm backend/data/quant.db
./start.sh
```

## 📚 相关文档

- **智能仓位详细指南**: `docs/SMART_POSITION_GUIDE.md`
- **策略创建指南**: `docs/STRATEGY_CREATION_GUIDE.md`  
- **功能说明**: `智能仓位管理功能说明.md`
- **测试脚本**: `test_smart_position.py`

## 🧪 测试功能

### 方法1：使用界面测试

1. 启动系统
2. 访问 http://localhost:8000
3. 点击"智能仓位"
4. 尝试计算一个仓位

### 方法2：使用测试脚本

```bash
python test_smart_position.py
```

这会测试：
- ✅ 组合状态获取
- ✅ 仓位计算
- ✅ 批量策略生成

### 方法3：使用 API

访问 API 文档：**http://localhost:8000/docs**

测试接口：
```bash
# 获取组合状态
curl http://localhost:8000/position-manager/portfolio-status

# 计算仓位
curl -X POST http://localhost:8000/position-manager/calculate \
  -H "Content-Type: application/json" \
  -d '{
    "symbol": "AAPL.US",
    "action": "buy",
    "method": "percentage",
    "target_allocation": 0.1
  }'
```

## 💡 使用建议

### 第一次使用

1. **先配置凭据**
   - 点击"基础配置"
   - 输入 Longbridge API 凭据
   - 点击"校验"确认

2. **查看持仓**
   - 点击"持仓K线"
   - 查看当前持仓情况

3. **计算仓位**
   - 点击"智能仓位"
   - 为新股票计算买入数量

4. **创建策略**
   - 使用批量功能生成策略
   - 在"策略控制"中启用

### 最佳实践

1. **保守起步**
   - 初始配置：每只 5-10%
   - 止损设置：5-8%
   - 测试策略后再扩大

2. **分散投资**
   - 至少 5-8 只股票
   - 不同行业和市场
   - 避免集中风险

3. **定期检查**
   - 每周查看持仓
   - 根据表现调整
   - 及时止盈止损

## 🎉 开始使用

现在一切就绪！执行以下命令开始：

```bash
./start.sh
```

然后访问：**http://localhost:8000**

点击 **"智能仓位"** 🎲 标签即可开始使用！

---

**提示**: 如果遇到任何问题，请查看：
- 日志文件：`logs/backend.log`
- API 文档：http://localhost:8000/docs
- 详细指南：`docs/SMART_POSITION_GUIDE.md`

















